{"version":3,"sources":["app/DirectRpcCaller.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAEA,kDAAkD;AAElD,+DAAyD;AAEzD,mCAAmC;AAanC,IAAa,aAAa,GAA1B,mBACG,SAAQ,GAAG,CAAC,aAAa;IAM3B;QACC,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,aAAa,GAAG,OAAO,CAAC;IAC9B,CAAC;IAED,IAAW,WAAW;QACrB,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC;IAC1B,CAAC;IAED,IAAW,WAAW,CAAC,GAAW;QACjC,IAAI,CAAC,YAAY,GAAG,GAAG,CAAC;IACzB,CAAC;IAGD;;OAEG;IACI,IAAI,CAAC,KAAW;IACvB,CAAC;IAED;;OAEG;IACU,OAAO;;;YACnB,MAAM,iBAAa,WAAE,CAAC;YACtB,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;QAC3B,CAAC;KAAA;IAED;;OAEG;IACI,IAAI,CAAC,UAAkB,EAAE,MAAc,EAAE,MAAY;QAC3D,4BAAK,CAAC,gBAAgB,CAAC,YAAY,EAAE,UAAU,CAAC,CAAC;QACjD,4BAAK,CAAC,gBAAgB,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;QACzC,4BAAK,CAAC,eAAe,CAAC,IAAI,CAAC,YAAY,EAAE,uBAAuB,CAAC,CAAC;QAElE,IAAI,OAAO,GAAoB;YAC7B,IAAI,EAAE,IAAI,CAAC,IAAI;YACf,EAAE,EAAE,UAAU;YACd,OAAO,EAAE,MAAM;SACf,EACD,OAAO,GAAoB;YAC1B,MAAM,EAAE,MAAM;YACd,GAAG,EAAE,UAAU,IAAI,CAAC,YAAY,IAAI,UAAU,IAAI,MAAM,EAAE;YAC1D,IAAI,EAAE,OAAO;YACb,IAAI,EAAE,IAAI;YACV,OAAO,EAAE,IAAI,CAAC,OAAO;SACrB,CAAC;QAEH,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC;aAChC,KAAK,CAAC,WAAW,IAAI,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;IAC9E,CAAC;CACD,CAAA;AA3DY,aAAa;IADzB,iCAAU,EAAE;;GACA,aAAa,CA2DzB;AA3DY,sCAAa","file":"DirectRpcCaller.js","sourcesContent":["import { EventEmitter } from 'events';\r\n\r\nimport * as request from 'request-promise-native';\r\n\r\nimport { injectable, Guard } from 'back-lib-common-util';\r\n\r\nimport * as rpc from './RpcCommon';\r\n\r\n\r\nexport interface IDirectRpcCaller extends rpc.IRpcCaller {\r\n\t/**\r\n\t * IP address or host name including port number.\r\n\t * Do not include protocol (http, ftp...) because different class implementations\r\n\t * will prepend different protocols.\r\n\t */\r\n\tbaseAddress: string;\r\n}\r\n\r\n@injectable()\r\nexport class HttpRpcCaller\r\n\t\t\textends rpc.RpcCallerBase\r\n\t\t\timplements IDirectRpcCaller {\r\n\r\n\tprivate _baseAddress: string;\r\n\tprivate _requestMaker: (options) => Promise<any>;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._requestMaker = request;\r\n\t}\r\n\r\n\tpublic get baseAddress(): string {\r\n\t\treturn this._baseAddress;\r\n\t}\r\n\r\n\tpublic set baseAddress(val: string) {\r\n\t\tthis._baseAddress = val;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @see IRpcCaller.init\r\n\t */\r\n\tpublic init(param?: any): void {\r\n\t}\r\n\r\n\t/**\r\n\t * @see IRpcCaller.dispose\r\n\t */\r\n\tpublic async dispose(): Promise<void> {\r\n\t\tawait super.dispose();\r\n\t\tthis._requestMaker = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @see IRpcCaller.call\r\n\t */\r\n\tpublic call(moduleName: string, action: string, params?: any): Promise<rpc.IRpcResponse> {\r\n\t\tGuard.assertArgDefined('moduleName', moduleName);\r\n\t\tGuard.assertArgDefined('action', action);\r\n\t\tGuard.assertIsDefined(this._baseAddress, 'Base URL must be set!');\r\n\r\n\t\tlet request: rpc.IRpcRequest = {\r\n\t\t\t\tfrom: this.name,\r\n\t\t\t\tto: moduleName,\r\n\t\t\t\tpayload: params\r\n\t\t\t},\r\n\t\t\toptions: request.Options = {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\turi: `http://${this._baseAddress}/${moduleName}/${action}`,\r\n\t\t\t\tbody: request,\r\n\t\t\t\tjson: true, // Automatically stringifies the body to JSON\r\n\t\t\t\ttimeout: this.timeout\r\n\t\t\t};\r\n\r\n\t\treturn this._requestMaker(options)\r\n\t\t\t.catch(rawResponse => Promise.reject(this.rebuildError(rawResponse.error)));\r\n\t}\r\n}"]}